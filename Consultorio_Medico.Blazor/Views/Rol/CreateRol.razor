@page "/create-rol"

@using Microsoft.AspNetCore.Components;
@using Microsoft.AspNetCore.Components.Forms;
@using System.ComponentModel.DataAnnotations;
@using Consultorio_Medico.BL.DTOs.RolDTO;
@using Consultorio_Medico.Blazor.Data;

@if (isSuccess == false && isError == false)
{
    <!DOCTYPE html>
    <EditForm Model="rolInput" OnValidSubmit="Create">
        <html>
        <body>
            <h3>Crea un nuevo Rol</h3>

            <div class="input-group mb-3">
                <span class="input-group-text" id="Name"></span>
                <InputText class="form-control" id="Name" @bind-Value="rolInput.Name" />
            </div>

            <select class="form-select" aria-label="Status" id="statusSelect" @onchange="HandleSelectChange">
                <option value="1">ACTIVO</option>
                <option value="2">INACTIVO</option>
            </select>

            <div class="row">
                <div class="col-12">
                    <button type="submit" class="btn btn-outline-primary">Guardar</button>
                </div>
                <br>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="col-12">
                        <NavLink href="/roles" class="btn btn-outline-secondary">Cancelar</NavLink>
                    </div>
                </div>
            </div>
        </body>
    </html>
    </EditForm>
}
else if (isSuccess)
{
    rolInput = new RolInputDTO();

    isError = false;
    <p class="alert alert-success">Rol creado con éxito.</p>
    <button type="button" @onclick="GoCreate" class="btn btn-primary">Ir a Crear</button>
    <NavLink href="/roles" class="btn btn-primary">Ir a buscar personas</NavLink>
}
else if (isError)
{
    <p class="alert alert-success">Sucedio un error al intentar registrar</p>
    <NavLink href="/roles" class="btn btn-primary">Aceptar</NavLink>
}



@code {

    [Inject]
    RolService rolService { get; set; }

    RolInputDTO rolInput = new RolInputDTO();

    bool isSuccess = false;
    bool isError = false;

    private async Task Create()
    {
        var result = await rolService.Create(rolInput);
        if (result != null)
            isSuccess = true;
        else
            isError = true;
    }

    private void GoCreate()
    {
        isSuccess = false;
        isError = false;
    }

    byte status = 0;

    private void HandleSelectChange(ChangeEventArgs e)
    {
        rolInput.Status = Convert.ToByte(e.Value.ToString());
    }

}
